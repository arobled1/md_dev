\documentclass{article}
%=============================================================================80
%	                          Packages                                     %
%==============================================================================%
% Packages
\usepackage[utf8]{inputenc}
\usepackage{graphicx}
\usepackage{amsmath}
\usepackage{mathtools}
\usepackage{amssymb}
\usepackage{braket}
\usepackage{float}
\usepackage{subcaption}
\usepackage[margin=0.7in]{geometry}
\usepackage[version=4]{mhchem}
\usepackage{cite}
%==============================================================================%
%                           User-Defined Commands                              %
%==============================================================================%
% User-Defined Commands
\newcommand{\be}{\begin{equation}}
\newcommand{\ee}{\end{equation}}
\newcommand{\benum}{\begin{enumerate}}
\newcommand{\eenum}{\end{enumerate}}
\newcommand{\pd}{\partial}
\newcommand{\dg}{\dagger}

%==============================================================================%
%                             Title Information                                %
%==============================================================================%
\title{PIMD Notes}
\date{11/14/19}
\author{Alan Robledo}
%==============================================================================%
\begin{document}

\maketitle

I have created the following notes to better understand path integral molecular dynamics (PIMD) as applied to a harmonic oscillator and beyond. All the material in this paper can be found in mutliple resources. The ones that I used are listed in the references. Notes are still in development.

\section{Introduction}
\subsection{Quantum Harmonic Oscillator}
Similar to the classical harmonic oscillator, we have a particle that is subject to a harmonic potential so that the 1D Hamiltonian looks like
\be \label{eq:harm_osc}
  \hat{H} = \hat{K} + \hat{U} = \frac{\hat{p}^2}{2m} + \frac{1}{2}m \omega^2\hat{x}^2
\ee
where $m$ is the particle's mass and $\omega$ is the angular frequency of the oscillator.
We know that we can derive the properties of the harmonic oscillator from the canonical ensemble. To do this, we start with the canonical partition function,
\be \label{eq:classical_part_func}
  Q = \sum_n e^{-\beta E_n}
\ee
where the sum is performed over all possible states of the system, which are discrete.\cite{tuckerman}
We can derive the formula for the energies from introductory quantum mechanics.

The energies can be obtained from solving Schr\"odinger's equation with the Hamiltonian in equation (\ref{eq:harm_osc}).
Alternatively, the energies can be obtained using Dirac's ladder operators, $\hat{a}$ and $\hat{a}^{\dagger}$.\cite{griffiths,shankar}
The "raising operator" $\hat{a}$ and "lowering operator" $\hat{a}^{\dagger}$ can be defined in terms of the position and momentum operators as
\be
  \begin{split}
    \hat{a} &= \sqrt{\frac{m \omega}{2 \hbar}} \Big( \hat{x} + \frac{i}{m \omega} \hat{p}\Big) \\
    \hat{a}^{\dagger} &= \sqrt{\frac{m \omega}{2 \hbar}} \Big( \hat{x} - \frac{i}{m \omega} \hat{p}\Big)
  \end{split}
\ee
where the prefactors are such that they allow the math to work out nicely when deriving the energies for a harmonic oscillator.
The ladder operators can then be used to obtain a function of the Hamiltonian by remembering the commutation relation $[\hat{x},\hat{p}] = i \hbar$. The hats will be ommited from the operators to simplify notation.
\be
  \begin{split}
    aa^{\dagger} &= \sqrt{\frac{m \omega}{2 \hbar}} \Big( x + \frac{i}{m \omega} p\Big) \sqrt{\frac{m \omega}{2 \hbar}} \Big( x - \frac{i}{m \omega} p\Big) \\
    &= \frac{m \omega}{2 \hbar} \Big( x + \frac{i}{m \omega} p\Big) \Big( x - \frac{i}{m \omega} p\Big) \\
    &= \frac{m \omega}{2 \hbar} \Big( x^2 - \frac{i}{m \omega}xp + \frac{i}{m \omega}px + \frac{p^2}{(m \omega)^2} \Big) \\
    &= \frac{m \omega}{2 \hbar} \Big( x^2 + \frac{p^2}{(m \omega)^2} \Big) - \frac{i}{2 \hbar}xp + \frac{i}{2 \hbar}px \\
    &= \frac{m \omega}{2 \hbar} \Big( \frac{m \omega}{m \omega} \Big) \Big( x^2 + \frac{p^2}{(m \omega)^2} \Big) - \frac{i}{2 \hbar}xp + \frac{i}{2 \hbar}px \\
    &= \frac{1}{2 \hbar} \Big( \frac{p^2}{m \omega} + m \omega x^2\Big) - \frac{i}{2 \hbar} [x,p] \\
    &= \frac{1}{\hbar \omega} \Big( \frac{p^2}{2m} + \frac{(m \omega x)^2}{2m}\Big) - \frac{i}{2 \hbar} (i \hbar) \\
    &= \frac{1}{\hbar \omega} H + \frac{1}{2}
  \end{split}
\ee
So rearranging to solve for the Hamiltonian gives us,
\be \label{eq:h_plusminus}
  \hat{H} = \hbar \omega \Big( \hat{a} \hat{a}^{\dagger} - \frac{1}{2} \Big) .
\ee
If we reverse the ladder operators we get,
\be
  \begin{split}
    a^{\dagger}a &= \sqrt{\frac{m \omega}{2 \hbar}} \Big( x - \frac{i}{m \omega} p\Big) \sqrt{\frac{m \omega}{2 \hbar}} \Big( x + \frac{i}{m \omega} p\Big) \\
    &= \frac{m \omega}{2 \hbar} \Big( x - \frac{i}{m \omega} p\Big) \Big( x + \frac{i}{m \omega} p\Big) \\
    &= \frac{m \omega}{2 \hbar} \Big( x^2 + \frac{i}{m \omega}xp - \frac{i}{m \omega}px + \frac{p^2}{(m \omega)^2}\Big) \\
    &= \frac{m \omega}{2 \hbar} \Big( x^2 + \frac{p^2}{(m \omega)^2}\Big) + \frac{i}{2 \hbar}xp - \frac{i}{2 \hbar}px \\
    &= \frac{m \omega}{2 \hbar} \Big( \frac{m \omega}{m \omega} \Big) \Big( x^2 + \frac{p^2}{(m \omega)^2}\Big) + \frac{i}{2 \hbar}xp - \frac{i}{2 \hbar}px \\
    &= \frac{1}{2 \hbar} \Big( \frac{p^2}{m \omega} + m \omega x^2 \Big) + \frac{i}{2 \hbar} [x,p] \\
    &= \frac{1}{2 \hbar m \omega} \Big( p^2 + (m \omega x)^2 \Big) + \frac{i}{2 \hbar} (i \hbar) \\
    &= \frac{1}{\hbar \omega} \Big( \frac{p^2}{2m} + \frac{(m \omega x)^2}{2m} \Big) - \frac{1}{2} \\
    &= \frac{1}{\hbar \omega}H - \frac{1}{2}
  \end{split}
\ee
And rearranging to solve for the Hamiltonian gives us,
\be \label{eq:h_minusplus}
  \hat{H} = \hbar \omega \Big(\hat{a}^{\dagger} \hat{a} + \frac{1}{2} \Big) .
\ee
We can imagine a set of vectors that make up the basis of eigenvectors $\ket{\psi_n}$ for the harmonic oscillator Hamiltonian that yield energies $E_n$.
If we apply equation (\ref{eq:h_plusminus}) to a vector that is one state higher $\hat{a}\ket{\psi_n}$, we obtain,
\be
  H \hat{a}\ket{\psi} = (E_n + \hbar \omega) \hat{a}\ket{\psi}.
\ee
eigenvalues equal to the energy in the previous state plus $\hbar \omega$.
Likewise, if we apply equation (\ref{eq:h_minusplus}) to a vector that is one state lower $\hat{a}^{\dagger}\ket{\psi_n}$, we obtain,
\be
  H \hat{a}^{\dagger}\ket{\psi} = (E_n - \hbar \omega) \hat{a}^{\dagger}\ket{\psi} .
\ee
It is for this reason that the operators $\hat{a}$ and $\hat{a}^{\dagger}$ are called ladder operators because they allow us to go up and down in energy.\cite{griffiths,shankar}
When we consider that there is a ground state $\ket{\psi_0}$ such that $\hat{a}^{\dagger}\ket{\psi_0} = 0$, we can plug in the defintion for $\hat{a}^{\dagger}$ and solve for $\ket{\psi_0}$, giving,
\be
  \psi_0(x) = \Big(\frac{m \omega}{\pi \hbar}\Big)^{1/4} e^{-\frac{m \omega x^2}{2 \hbar}}
\ee
Plugging this into the Schr\"odinger equation gives the energy,
\be
  E_0 = \frac{\hbar \omega}{2} .
\ee
Since we know that applying the raising operator $\hat{a}$ increases the energy by $\hbar \omega$, applying $\hat{a}$ $n$ times increases the energy by $n \hbar \omega$.
So the energy at the nth state can be defined as,
\be
  E_n = \hbar \omega(n + \frac{1}{2}) .
\ee

Plugging our energies into equation (\ref{eq:classical_part_func}) gives us the partition function.
\be \label{eq:harm_part_func}
  Q = \sum_{n=0}^{\infty} e^{-\beta \hbar \omega(n + \frac{1}{2})}
\ee
We can actually evaluate the sum to get a more compact form of equation (\ref{eq:harm_part_func}) by remembering that $\hbar$, $\omega$, $\beta$, are just constants and $\sum\limits_{n=0}^{\infty} x^n = \frac{1}{1-x}$ where $0 < x < 1$.
\be
  \begin{split}
    Q &= \sum_{n=0}^{\infty} e^{-\beta \hbar \omega(n + \frac{1}{2})} \\
    &= e^{-\frac{\beta \hbar \omega}{2}} \sum_{n=0}^{\infty} e^{- \beta \hbar \omega n} \\
    &= e^{-\frac{\beta \hbar \omega}{2}} \sum_{n=0}^{\infty} \Big( e^{- \beta \hbar \omega} \Big)^n \\
    &= \frac{e^{-\frac{\beta \hbar \omega}{2}}}{1-e^{-\beta \hbar \omega}} \\
    &= \Big( \frac{e^{\frac{\beta \hbar \omega}{2}}}{e^{\frac{\beta \hbar \omega}{2}}} \Big) \frac{e^{-\frac{\beta \hbar \omega}{2}}}{1-e^{-\beta \hbar \omega}} \\
    &= \frac{1}{e^{\frac{\beta \hbar \omega}{2}} - e^{-\frac{\beta \hbar \omega}{2}}} \\
    &= \frac{1}{2 \sinh(\frac{\beta \hbar \omega}{2})}
  \end{split}
\ee
The purpose of knowing the canonical partition function is so that we can derive the thermodynamic properties of our system in the canonical ensemble. One property we can derive is the total energy. We already know the energies of the harmonic oscillator, but we can derive the energies in the canonical ensemble with the partition function using the relationship,
\be
  E = - \frac{\partial}{\partial \beta} \ln(Q) .
\ee
So plugging in the Q we found gives us,
\be
  \begin{split}
    E &= - \frac{\partial}{\partial \beta} \ln \Big( \frac{1}{2 \sinh(\frac{\beta \hbar \omega}{2})} \Big) \\
    &= - \frac{\partial}{\partial \beta} \Big[ \ln(1) - \ln \Big(2 \sinh(\frac{\beta \hbar \omega}{2})\Big) \Big] \\
    &= \frac{\partial}{\partial \beta} \ln \Big(2 \sinh(\frac{\beta \hbar \omega}{2})\Big) \\
    &= \frac{1}{2 \sinh(\frac{\beta \hbar \omega}{2})} \frac{\partial}{\partial \beta} 2 \sinh(\frac{\beta \hbar \omega}{2}) \\
    &= \frac{2 \cosh(\frac{\beta \hbar \omega}{2})}{2 \sinh(\frac{\beta \hbar \omega}{2})} \frac{\partial}{\partial \beta} \frac{\beta \hbar \omega}{2} \\
    &= \frac{\cosh(\frac{\beta \hbar \omega}{2})}{\sinh(\frac{\beta \hbar \omega}{2})} \Big( \frac{\hbar \omega}{2}\Big) \\
    &= \frac{\hbar \omega}{2 \tanh(\frac{\hbar \omega}{2})}
  \end{split}
\ee
The equation for the total energy can be made exactly the same as in Tuckerman's book \cite{tuckerman} by expressing the inverse $\tanh$ function in terms of exponentials.
\be \label{eq:harm_canonical_e}
  \begin{split}
    E &= \frac{\hbar \omega}{2 \tanh(\frac{\hbar \omega}{2})} \\
    &= \Big( \frac{\hbar \omega}{2} \Big) \frac{e^{\frac{\beta \hbar \omega}{2}} + e^{-\frac{\beta \hbar \omega}{2}} }{e^{\frac{\beta \hbar \omega}{2}} - e^{-\frac{\beta \hbar \omega}{2}}  }\\
    &= \Big( \frac{\hbar \omega}{2} \Big) \Big( \frac{e^{-\frac{\beta \hbar \omega}{2}}}{e^{-\frac{\beta \hbar \omega}{2}}}\Big) \frac{e^{\frac{\beta \hbar \omega}{2}} + e^{-\frac{\beta \hbar \omega}{2}} }{e^{\frac{\beta \hbar \omega}{2}} - e^{-\frac{\beta \hbar \omega}{2}}  } \\
    &= \Big( \frac{\hbar \omega}{2} \Big) \frac{1 + e^{- \beta \hbar \omega} }{1 - e^{- \beta \hbar \omega}} \\
    &= \Big( \frac{\hbar \omega}{2} \Big) \frac{(1-e^{-\beta \hbar \omega} + 2e^{-\beta \hbar \omega})}{1-e^{-\beta \hbar \omega}} \\
    &= \Big( \frac{\hbar \omega}{2} \Big) \frac{1-e^{-\beta \hbar \omega}}{1-e^{-\beta \hbar \omega}} + \Big( \frac{\hbar \omega}{2} \Big)\frac{2e^{-\beta \hbar \omega}}{1-e^{-\beta \hbar \omega}} \\
    &= \frac{\hbar \omega}{2} + \frac{\hbar \omega e^{-\beta \hbar \omega}}{1-e^{-\beta \hbar \omega}}
  \end{split}
\ee
Remember that this is the exact form of the harmonic oscillator energies in the canonical ensemble and not an approximation. When we try to approximate the energies of a harmonic oscillator using PIMD, we will want to refer back to equation (\ref{eq:harm_canonical_e}) and plug in our values for $\omega$ and $\beta$ as a check to make sure that our code is working.

To understand what a PIMD code does, we have to first understand the idea of representing partition functions like equation (\ref{eq:harm_part_func}) as a path integral. So now let's talk about where the path integral representation comes from.

\subsection{Path Integral Derivation}
We will consider the case of a single quantum particle moving in one dimension subject to some potential $U(x)$.
Remember that our Hamiltonian is, in general,
\be
  \hat{H} = \hat{K} + \hat{U} .
\ee
We already know from classical statistical mechanics that the canonical partition function can be written as equation (\ref{eq:harm_part_func}).
In Quantum Statistical Mechanics, the parition function is written more formally as,
\be \label{eq:quan_part_func}
  Q(N, V, T) = \text{Tr}\Big[ e^{- \beta \hat{H}} \Big]
\ee
where $\beta = 1/k_BT$ and $\hat{H}$ is the Hamiltonian of our system.

You can obtain the form of the partition function in equation (\ref{eq:harm_part_func}) by writing the exponential in equation (\ref{eq:quan_part_func}) as a power series in $\hat{H}$ (remember that $e^x = \sum\limits_{n=0}^{\infty} \frac{x^n}{n!}$).
\be
  e^{-\beta \hat{H}} = \sum_{n=0}^{\infty} \frac{(-\beta)^n \hat{H}^n}{n!}
\ee
We can perform a unitary transformation on $\hat{H}$ so that it becomes a diagonal matrix of its eigenvalues with $\hat{H} = \textbf{U}\textbf{D}\textbf{U}^{-1}$, where $\textbf{D}$ is the diagonal matrix of eigenvalues and $\textbf{U}$ is a matrix with the ith column being the eigenvector corresponding to the ith eigenvalue on the diagonal matrix.
\be
  e^{-\beta \hat{H}} = \sum_{n=0}^{\infty} \frac{(-\beta)^n (\textbf{U}\textbf{D}\textbf{U}^{-1})^n}{n!}
\ee
If we write out the first few terms we can see that the $\textbf{U}^{-1}$ and $\textbf{U}$ can be taken out of the sum,
\be
  \begin{split}
    e^{-\beta \hat{H}} &= [\textbf{I} + \frac{(-\beta)^1}{1!} (\textbf{U}\textbf{D}\textbf{U}^{-1}) + \frac{(-\beta)^2}{2!} (\textbf{U}\textbf{D}\textbf{U}^{-1})^2 + \dots] \\
    &= [\textbf{I} + \frac{(-\beta)^1}{1!} (\textbf{U}\textbf{D}\textbf{U}^{-1}) + \frac{(-\beta)^2}{2!} (\textbf{U}\textbf{D}\textbf{U}^{-1})(\textbf{U}\textbf{D}\textbf{U}^{-1}) + \dots] \\
    &= [\textbf{I} + \frac{(-\beta)^1}{1!} (\textbf{U}\textbf{D}\textbf{U}^{-1}) + \frac{(-\beta)^2}{2!} (\textbf{U}\textbf{D}\textbf{D}\textbf{U}^{-1}) + \dots] \\
    &= [\textbf{U}\textbf{U}^{-1} + \frac{(-\beta)^1}{1!} (\textbf{U}\textbf{D}\textbf{U}^{-1}) + \frac{(-\beta)^2}{2!} (\textbf{U}\textbf{D}\textbf{D}\textbf{U}^{-1}) + \dots] \\
    &= \textbf{U} [\textbf{I} + \frac{(-\beta)^1}{1!} \textbf{D} + \frac{(-\beta)^2}{2!} + \textbf{D}^2 + \dots] \textbf{U}^{-1} \\
    &= \textbf{U} e^{-\beta \textbf{D}} \textbf{U}^{-1}
  \end{split}
\ee
exploiting the property of unitary matrices $\textbf{U}\textbf{U}^{-1} = \textbf{I}$.
Then we use the cyclic property of the trace to show that the trace of a matrix is independent of the basis we choose to represent the matrix in,
\be
  \begin{split}
    \text{Tr} \Big[e^{-\beta \hat{H}}\Big] &= \text{Tr} \Big[ \textbf{U} e^{-\beta \textbf{D}} \textbf{U}^{-1} \Big] \\
    &= \text{Tr} \Big[ e^{-\beta \textbf{D}} \textbf{U} \textbf{U}^{-1} \Big]\\
    &= \text{Tr} \Big[ e^{-\beta \textbf{D}} \Big]
  \end{split}
\ee
And since $\textbf{D}$ is a diagonal matrix of the Hamiltonian eigenvalues $E_i$, the exponential matrix is just a diagonal matrix with the ith diagonal entry being $e^{-\beta E_i}$.
So the trace just becomes a sum of exponentials,
\be
  \text{Tr} \Big[e^{-\beta \hat{H}}\Big] = \sum_i e^{-\beta E_i}
\ee
giving us equation (\ref{eq:harm_part_func}).
Anybody who has a background in physics and believes that this is trivial will simply say that if the Hamiltonian is written in the basis of its eigenvectors then its trace becomes a sum of its eigenvalues, rather than show why that is the case.
I have chosen to show this to make a point that it is completely valid to work with the trace of $e^{-\beta \hat{H}}$ when we consider the quantum partition function.

We can now confidently write the partition function for our system in the coordinate basis as,
\be \label{eq:part_func_coord}
  Q = \text{Tr} \Big[e^{-\beta \hat{H}}\Big] = \int dx \braket{x|e^{-\beta \hat{H}}|x}
\ee
% Might use bottom later
%===========================================================================%
% The amplitude of a path that the particle can take when going from x to x' over some time t as the propagator written in position space.
% \be
%   A = \braket{x'|e^{-iHt/\hbar}|x}
% \ee
% This is useful to know because the probability of the particle choosing a particular path would simply be $|A|^2$.\cite{tuckerman}
% In terms of state vectors, the initial state of our particle can be represented as $\ket{\Psi(0)}$, so the state of our particle can be represented as the inital state vector being acted upon by the propagator
% \be
%   \ket{\Psi(t)} = e^{-iHt/\hbar} \ket{\Psi(0)}
% \ee
% And we can project the coordinate basis onto our state vectors to give us a meaningful representation of our state vector
% \be
%   \begin{split}
%     \braket{x'|\Psi(t)} = \Psi(x',t) &= \braket{x'|e^{-iHt/\hbar}|\Psi(0)} \\
%     &= \braket{x'|e^{-iHt/\hbar}\int dx|x} \braket{x|\Psi(0)} \\
%     &= \int dx \braket{x'|e^{-iHt/\hbar}|x} \braket{x|\Psi(0)} \\
%     &= \int dx \braket{x'|e^{-iHt/\hbar}|x} \Psi(x,0)
%   \end{split}
% \ee
% where we introduced the resolution of identity $\int dx \ket{x} \bra{x} = 1$.
%
% So now we have a more mathematical representation of our problem; we want to know how to go from $\Psi(x,0)$ to $\Psi(x',t)$.
% The physical representation of our problem is that we have a particle at some point x in space, and we want to be able to detect our particle at some other point x' in space after some time t passes.
%
% By going to imaginary time, which is done by substituting $it/\hbar = \beta$, we can express the coordinate-space quantum propagator as the canonical density matrix,
% \be \label{eq:density_mat}
%   \rho(x,x') = \braket{x'|e^{-\beta \hat{H}}| x} .
% \ee
% The motive behind doing this is so that we can deal with a damped exponential as opposed to a complex exponential.\cite{tuckerman}
% Therefore, we can derive the path integral form of the density matrix and simply resubstitute time in place of $\beta$ to obtain the path integral form of the time propagator.
%===========================================================================%
We would like to separate the Hamiltonian into its kinetic and potential energy components, $\hat{H} = \hat{K} + \hat{U}$.
However, we cannot split the exponentials because for two operators that do not commute $\text{exp}(\hat{H}) \neq \text{exp}(\hat{K}) \text{exp}(\hat{U})$.
To get around this we employ the trotter decompositon
\be
  e^{- \beta \hat{H}} = e^{- \beta (\hat{K} + \hat{U})} = \lim_{P \to\infty} \Big[ e^{- \beta \hat{U}/2P} e^{-\beta \hat{K}/P} e^{-\beta{U}/2P} \Big]^P .
\ee
Substituting this into equation (\ref{eq:part_func_coord}) gives us,
\be
  Q = \lim_{P \to\infty} \int dx \bra{x} \Big[ e^{- \beta \hat{U}/2P} e^{-\beta \hat{K}/P} e^{-\beta{U}/2P} \Big]^P \ket{x}
\ee
which can be condensed by defining another operator $\Omega$ as
\be
  \Omega = e^{-\beta \hat{U}/2P} e^{-\beta \hat{K}/P} e^{-\beta \hat{U}/2P} .
\ee
So our partition function becomes,
\be
  Q = \lim_{P \to\infty} \int dx \braket{x|\Omega^P|x}
\ee
We can insert the resolution of identity in terms of the position basis P-1 times between each of the omegas, remembering that $\Omega^P = \Omega \Omega \cdots \Omega$.
\be
  Q = \lim_{P \to\infty} \int \cdots \int dx_P \cdots dx_2 dx \braket{x|\Omega|x_P} \braket{x_P|\Omega|x_{P-1}} \bra{x_{P-1}} \cdots \ket{x_3} \braket{x_3|\Omega|x_2} \braket{x_2|\Omega|x}
\ee
In order to ensure that we obtain all the diagonal elements in the trace, we set $x_{P+1} = x_1 = x$,
\be \label{eq:part_func_path_int}
  Q = \lim_{P \to\infty} \int \cdots \int dx_P \cdots dx_2 dx_1 \braket{x_1|\Omega|x_P} \braket{x_P|\Omega|x_{P-1}} \bra{x_{P-1}} \cdots \ket{x_3} \braket{x_3|\Omega|x_2} \braket{x_2|\Omega|x_1}
\ee
which gives us the reason for why the system in path integral molecular dynamics is often portrayed as a periodic lattice of beads.
If we think of each $x_i$ as the coordinate for the ith bead, then the only way for the condition $x_{P+1} = x_1$ to make sense physically is if the beads are arranged as a necklace.
% Might use bottom later
%===========================================================================%
% The integrations over $x_1,\dots,x_P$ can then be thought of as the sum over all possible paths that your particle can take in imaginary time $-i \beta \hbar$ from because we can obtain integrations over all possible paths when P $\rightarrow \infty$.
%===========================================================================%

In order to evaluate $\Omega$ we want to consider an element of the matrix,
\be \label{eq:omega_mat}
  \braket{x_{k+1}|\Omega|x_k} = \braket{x_{k+1}|e^{-\beta \hat{U}/2P} e^{-\beta \hat{K}/P} e^{-\beta \hat{U}/2P}|x_k} .
\ee
We can recognize that the set of $\ket{x_k}$ are eigenvectors of $e^{-\beta \hat{U}/2P}$ with eigenvalue $e^{-\beta U(x_k)/2P}$ because $\hat{U} = U(\hat{x})$ is a function of the coordinate operator.\cite{griffiths,shankar}
This can be shown easily by writing the exponential as a power series in $\hat{U}$.
\be
  e^{-\beta \hat{U}/2P} = \sum_{n=0}^{\infty} \frac{\beta^n(2P)^{-n} \hat{U}^n}{n!}
\ee
and if we operate on an eigenvector $\ket{x_k}$, we get
\be
  \begin{split}
    e^{-\beta \hat{U}/2P} \ket{x_k} &= \sum_{n=0}^{\infty} \frac{\beta^n(2P)^{-n}}{n!} \hat{U}^n \ket{x_k} \\
    &= \sum_{n=0}^{\infty} \frac{\beta^n(2P)^{-n}}{n!} (U(x_k))^n \ket{x_k} \\
    &= e^{-\beta U(x_k)/2P} \ket{x_k}
  \end{split}
\ee
So equation (\ref{eq:omega_mat}) simplifies to
\be
  \braket{x_{k+1}|\Omega|x_k} = e^{-\beta U(x_{k+1})/2P} \braket{x_{k+1}|e^{-\beta \hat{K}/P} |x_k} e^{-\beta U(x_k)/2P} .
\ee
We know that $\hat{K}$ is a function of the momentum operator, $\hat{K} = \hat{p}^2/2m$. \cite{griffiths,shankar} So we can use the same technique as we did with $\hat{U}$ and the position eigenvectors by introducing the resolution of identity in terms of the momentum basis,
\be
  \begin{split}
    \braket{x_{k+1}|\Omega|x_k} &= \int e^{-\beta U(x_{k+1})/2P} \bra{x_{k+1}}e^{-\beta \hat{K}/P} \ket{p}\braket{p|x_k} e^{-\beta U(x_k)/2P} \\
    &= \int e^{-\beta U(x_{k+1})/2P} e^{-\beta p^2/2mP} \braket{x_{k+1}|p}\braket{p|x_k} e^{-\beta U(x_k)/2P} dp
  \end{split}
\ee
where $\braket{x_{k+1}|p}$ is the momentum wavefunction expressed in the coordinate basis $x_{k+1}$, and $\braket{p|x_k}$ is the complex conjugate of the momentum wavefunction expressed in the coordinate basis $x_k$, i.e. $\braket{p|x_k} = \braket{x_k|p}^*$.

We can obtain a functional form of these wavefunctions by recalling the eigenvalue problem for the momentum operator,
\be
  \hat{p} \ket{p} = p \ket{p}
\ee
If we project this equation on the coordinate basis, we can make use of the hermitian property of the momentum operator to obtain
\be
  \braket{x|\hat{p}|p} = p \braket{x|p} \quad \Rightarrow \quad \braket{\hat{p} x|p} =  p \braket{x|p} \quad \Rightarrow \quad -i \hbar \frac{\partial}{\partial x} \braket{x|p} = p \braket{x|p}
\ee
And if we write $\braket{x|p} = \psi_p(x)$, then we just have a first order differential equation.
The solution to this equation can easily be found
\be
  - i \hbar \frac{\partial}{\partial x} \psi_p(x) = p \psi_p(x) \quad \Rightarrow \quad \int \frac{d \psi_p}{\psi_p} dx = \int \frac{ip}{\hbar} dx \quad \Rightarrow \quad \ln \psi_p(x) = \frac{ipx}{\hbar} + C_1 \quad \Rightarrow \quad \psi_p(x) = C_2 e^{ipx/\hbar}
\ee
where $C_2$ is a normalization constant.
With proper normalization, the momentum wavefunction looks like
\be
  \braket{x|p} = \psi_p(x) = \frac{1}{\sqrt{2 \pi \hbar}} e^{ipx/\hbar} .
\ee
And its complex conjugate looks like,
\be
  \braket{x|p}^* = \braket{p|x} = \frac{1}{\sqrt{2 \pi \hbar}} e^{-ipx/\hbar}
\ee

Our matrix elements for $\Omega$ can be rewritten as
\be
  \begin{split}
    \braket{x_{k+1}|\Omega|x_k} &= \int e^{-\beta U(x_{k+1})/2P} e^{-\beta p^2/2mP} \braket{x_{k+1}|p}\braket{p|x_k} e^{-\beta U(x_k)/2P} dp \\
    &= \frac{1}{2 \pi \hbar} \int e^{-\beta p^2/2mP} e^{-\beta(U(x_{k+1}) + U(x_k))/2P} e^{ip(x_{k+1} - x_k)/\hbar} dp
  \end{split}
\ee
We can move the exponential without the momenta outside of the integral and combine the exponentials with the momenta to obtain
\be
  \braket{x_{k+1}|\Omega|x_k} = \frac{1}{2 \pi \hbar} e^{-\beta(U(x_{k+1}) + U(x_k))/2P} \int e^{-\beta p^2/2mP + ip(x_{k+1} - x_k)/\hbar} dp
\ee
Since our momentum basis extends from $+ \infty$ to $- \infty$, we end up having an integral of a gaussian if we complete the square,
\be
  \begin{split}
    \frac{- \beta p^2}{2mP} + \frac{(x_{k+1} - x_k)ip}{\hbar} &= \frac{- \beta}{2mP} \Big[ p^2 - \frac{2imP(x_{k+1} - x_k)}{\beta \hbar} \Big] \\
    &= \frac{- \beta}{2mP} \Big[ \Big( p -  \frac{imP(x_{k+1} - x_k)}{\beta \hbar} \Big)^2 - \Big( \frac{imP(x_{k+1} - x_k)}{\beta \hbar} \Big)^2 \Big] \\
    &= \frac{- \beta}{2mP} \Big[ \Big( p -  \frac{imP(x_{k+1} - x_k)}{\beta \hbar} \Big)^2 + \frac{m^2P^2(x_{k+1} - x_k)^2}{\beta^2 \hbar^2} \Big] \\
    &= \frac{- \beta}{2mP} \Big( p -  \frac{imP(x_{k+1} - x_k)}{\beta \hbar} \Big)^2 - \frac{mP(x_{k+1} - x_k)^2}{2 \beta \hbar^2} \\
  \end{split}
\ee
and make a variable substitution,
\be
  u = p -  \frac{imP(x_{k+1} - x_k)}{\beta \hbar} .
\ee
Our integral is now,
\be
  \braket{x_{k+1}|\Omega|x_k} = \frac{1}{2 \pi \hbar} \text{exp} \Big[ \frac{-\beta(U(x_{k+1}) + U(x_k))}{2P} \Big] \text{exp} \Big[ \frac{-mP(x_{k+1} - x_k)^2}{2 \beta \hbar^2} \Big] \int e^\frac{-\beta u^2}{2mP} du
\ee
which evaluates to,
\be
  \begin{split}
    \braket{x_{k+1}|\Omega|x_k} &= \frac{1}{2 \pi \hbar} \text{exp} \Big[ -\frac{\beta}{2P}(U(x_{k+1}) + U(x_k)) \Big] \text{exp} \Big[ -\frac{mP}{2 \beta \hbar^2}(x_{k+1} - x_k)^2 \Big] \Big( \frac{2 \pi m P}{\beta} \Big)^{1/2} \\
    &= \Big( \frac{mP}{2 \pi \beta \hbar^2} \Big)^{1/2} \text{exp} \Big[ - \frac{mP}{2 \beta \hbar^2}(x_{k+1} - x_k)^2 - \frac{\beta}{2P}(U(x_{k+1}) + U(x_k)) \Big]
  \end{split}
\ee
Plugging in our matrix elements into equation (\ref{eq:part_func_path_int}) P times for each element gives us the discretized path integral representation of the quantum partition function.
\be \label{eq:part_func_with_omega}
  Q = \lim_{P \to\infty} \Big( \frac{mP}{2 \pi \beta \hbar^2} \Big)^{P/2} \int \cdots \int dx_P \cdots dx_1 \quad \text{exp}\Big( \sum_{k=1}^P \Big[ - \frac{mP}{2 \beta \hbar^2}(x_{k+1} - x_k)^2 - \frac{\beta}{2P}(U(x_{k+1}) + U(x_k)) \Big] \Big) .
\ee

For PIMD, we take advantage of the constant in front of equation (\ref{eq:part_func_with_omega}) by considering an integral over momentum variables that would evaluate to the constant.
It turns out that such an integral exists as a P dimensional gaussian integral.
\be
  \int \cdots \int dp_1 \cdots dp_P \quad \text{exp}\Big( \sum_{k=1}^P \frac{-\beta p^2_k}{2m'} \Big) = \Big( \frac{mP}{2 \pi \beta \hbar^2} \Big)^{P/2}
\ee
where $m' = mP/(2 \pi \hbar)^2$.
The integral can be easily evaluated by noticing that it is just the same integral multiplied P times.
\be
  \begin{split}
    \int \cdots \int dp_1 \cdots dp_P \quad \text{exp}\Big( \sum_{k=1}^P \frac{-\beta p^2_k}{2m'} \Big) &= \int \cdots \int dp_1 \cdots dp_P \quad \text{exp}\Big(\frac{-\beta p^2_1}{2m'} \Big) \text{exp}\Big( \frac{-\beta p^2_2}{2m'}\Big) \cdots \text{exp}\Big( \frac{-\beta p^2_P}{2m'} \Big) \\
    &= \Big[ \int dp_1 \quad \text{exp} \Big( \frac{-\beta p^2_1}{2m'} \Big)\Big]^P \\
    &= \Big[ \Big( \frac{2 \pi m'}{\beta} \Big)^{1/2} \Big]^P \\
    &= \Big[ \Big( \frac{2 \pi m P}{(2 \pi \hbar)^2 \beta } \Big)^{1/2} \Big]^P \\
    &= \Big( \frac{mP}{2 \pi \beta \hbar^2} \Big)^{P/2}
  \end{split}
\ee
Substituting the momentum integrals into equation (\ref{eq:part_func_with_omega}) with more clever manipulation gives us,
\be \label{eq:pimd_partition}
  \begin{split}
    Q &= \lim_{P \to\infty} \int dp_1 \cdots dp_P \int dx_P \cdots dx_1 \quad \text{exp}\Big( \sum_{k=1}^P \Big[ \frac{-\beta p^2_k}{2m'} - \frac{mP}{2 \beta \hbar^2}(x_{k+1} - x_k)^2 - \frac{\beta}{2P}(U(x_{k+1}) + U(x_k)) \Big] \Big) \\
    &= \lim_{P \to\infty} \int dp_1 \cdots dp_P \int dx_P \cdots dx_1 \quad \text{exp}\Big( - \beta \sum_{k=1}^P \Big[ \frac{p^2_k}{2m'} + \frac{mP}{2 \beta^2 \hbar^2}(x_{k+1} - x_k)^2 + \frac{1}{2P}(U(x_{k+1}) + U(x_k)) \Big] \Big) \\
    &= \lim_{P \to\infty} \int dp_1 \cdots dp_P \int dx_P \cdots dx_1 \quad \text{exp}\Big( - \beta \sum_{k=1}^P \Big[ \frac{p^2_k}{2m'} + \frac{1}{2} m \omega^2_P (x_{k+1} - x_k)^2 + \frac{1}{P} U(x_k) \Big] \Big) \\
  \end{split}
\ee
which resembles the classical partition function for a cyclic polymer chain of beads all with the same fictious mass m' and with harmonic nearest neighbors subject to an external potential $U(x)$ that is defined by the quantum system.
$\omega_P = \sqrt{P}/(\beta \hbar)$ is called the chain frequency, because it is the frequency associated with each spring between nearest neighbors.
This is the classical system that we evolve in time during a PIMD simulation.

Remember that all of this math was to show that PIMD considers evolving a classical system of cyclic chains and obtianing quantum properties of the system that the chains are representing.
Going back to the 1D quantum harmonic oscillator, a PIMD calculation would consist of computing the dynamics for one chain of P beads with each bead subject to an external potential $U(x) = (1/2)m \omega^2 x^2$, which defines the quantum oscillator.
\bibliography{mybib}
\bibliographystyle{unsrt}

\end{document}
